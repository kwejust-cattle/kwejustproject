<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cow Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="p-4">

<!-- Button to open modal -->
<button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#cowModal">
    Add New Cow
</button>

<!-- Cow Registration Modal -->
<div class="modal fade" id="cowModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Register New Cow</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="cowForm">

                    <!-- Cow Profile -->
                    <div class="card mb-3">
                        <div class="card-header">1. Cow Profile</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <input type="text" name="tag_id" class="form-control" placeholder="Tag ID" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <input type="text" name="name" class="form-control" placeholder="Cow Name">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <select name="breed" class="form-control" required>
                                        <option value="" disabled selected>Select Breed</option>
                                        <option value="Holstein">Holstein</option>
                                        <option value="Jersey">Jersey</option>
                                        <option value="Angus">Angus</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <input type="number" name="age" class="form-control" placeholder="Age (years)" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <input type="number" step="0.1" name="weight" class="form-control" placeholder="Weight (kg)" required>
                                </div>
                                <div class="col-md-12 mb-3">
                                    <textarea name="history" class="form-control" rows="2" placeholder="Cow History / Notes"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reproduction Tracking -->
                    <div class="card mb-3">
                        <div class="card-header">2. Reproduction Tracking</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <select name="reproduction_status" class="form-control">
                                        <option value="" disabled selected>Select Status</option>
                                        <option value="Healthy">Healthy</option>
                                        <option value="In Heat">In Heat</option>
                                        <option value="Pregnant">Pregnant</option>
                                        <option value="Calved">Calved</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <input type="date" name="last_heat" class="form-control" placeholder="Last Heat Date">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <input type="date" name="last_ai" class="form-control" placeholder="Last AI Date">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <input type="date" name="expected_calving" class="form-control" placeholder="Expected Calving Date">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lineage -->
                    <div class="card mb-3">
                        <div class="card-header">3. Lineage</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <input type="text" name="mother_tag" class="form-control" placeholder="Mother Tag ID">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <input type="text" name="father_tag" class="form-control" placeholder="Father Tag ID">
                                </div>
                                <div class="col-md-12 mb-3">
                                    <textarea name="lineage_notes" class="form-control" rows="2" placeholder="Lineage Notes"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="cowMsg"></div>
                    <button type="submit" class="btn btn-primary w-100">Save Cow</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Registered Cows Table -->
<div class="card">
    <div class="card-header bg-success text-white">Registered Cows</div>
    <div class="card-body">
        <table class="table table-bordered" id="cowTable">
            <thead>
                <tr>
                    <th>Tag ID</th>
                    <th>Name</th>
                    <th>Breed</th>
                    <th>Age</th>
                    <th>Weight</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be appended via AJAX -->
            </tbody>
        </table>
    </div>
</div>

<script>
$(document).ready(function() {
    // Example: Fetch and display cows (replace with your AJAX GET)
    function loadCows() {
        // Here you would use AJAX to get data from Django
        // For demo, we keep it empty
        $("#cowTable tbody").empty();
    }

    loadCows();

    // Submit Cow Form via AJAX
    $("#cowForm").on("submit", function(e) {
        e.preventDefault();
        let formData = $(this).serialize();

        $.ajax({
            url: "/add_cow/", // Your Django URL
            method: "POST",
            data: formData,
            success: function(response) {
                $("#cowMsg").html(`<div class="alert alert-success">${response.message}</div>`);
                $("#cowForm")[0].reset();
                $("#cowModal").modal('hide');

                // Add new row to table
                let cow = response.cow;
                $("#cowTable tbody").append(`
                    <tr>
                        <td>${cow.tag_id}</td>
                        <td>${cow.name}</td>
                        <td>${cow.breed}</td>
                        <td>${cow.age}</td>
                        <td>${cow.weight}</td>
                        <td>${cow.reproduction_status || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary">Edit</button>
                            <button class="btn btn-sm btn-danger">Delete</button>
                        </td>
                    </tr>
                `);
            },
            error: function(xhr) {
                let res = xhr.responseJSON;
                $("#cowMsg").html(`<div class="alert alert-danger">${res.message}</div>`);
            }
        });
    });
});
</script>

</body>
</html>